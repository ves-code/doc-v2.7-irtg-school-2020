<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>PLUMED: MARVEL-VES tutorial (Lugano Feb 2017): VES 2</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script>
   var redpath = "";
   
   function showPath(eg,name) {
     var i; var y = document.getElementsByName(redpath);
     for (i=0; i < y.length; i++ ) { y[i].style.color="black"; }
     var x = document.getElementsByName(name); redpath=name;
     for (i = 0; i < x.length; i++) { x[i].style.color="red"; }
     var valid="value_details_".concat(eg);
     var valueField = document.getElementById(valid);
     var dataField = document.getElementById(name);
     valueField.innerHTML = dataField.innerHTML;
   }
   function swapInput(name) {
     var btn = document.getElementById(name + "_button");
     var mydiv = document.getElementById("input_" + name);
     if( btn.textContent=="expand shortcuts" ) {
         btn.textContent = "contract shortcuts";
         var dataField = document.getElementById(name + "long");
         mydiv.innerHTML = dataField.innerHTML;
     } else if( btn.textContent=="contract shortcuts" ) {
         btn.textContent = "expand shortcuts";
         var dataField = document.getElementById(name + "short");
         mydiv.innerHTML = dataField.innerHTML;
     }
   }
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.7b</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ves-lugano2017-ves2.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">MARVEL-VES tutorial (Lugano Feb 2017): VES 2 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="ves-lugano2017-ves2-lo"></a>
Learning Outcomes</h1>
<p>Once this tutorial is completed students will learn to:</p>
<ul>
<li>Use the well-tempered target distribution and understand its usefulness</li>
<li>Construct biases in 1 and 2 dimensions.</li>
</ul>
<h1><a class="anchor" id="ves-lugano2017-ves2-resources"></a>
Resources</h1>
<p>The <a href="tutorial-resources/ves-lugano2017-ves2.tar.gz" download="ves-lugano2017-ves2.tar.gz">tarball </a> for this project contains the following folders:</p>
<ul>
<li>Example1 : Contains the input file for the the first example.</li>
<li>Example2 : Contains the input file for the the second example.</li>
</ul>
<h1><a class="anchor" id="ves-lugano2017-ves2-sumtheo"></a>
Summary of theory</h1>
<p>One of the most useful target distribution is the well-tempered one. The well-tempered target distribution is <a class="el" href="citelist.html#CITEREF_Valsson-JCTC-2015">[118]</a> : </p><p class="formulaDsp">
\[ p(\mathbf{s})=\frac{e^{-(\beta/\gamma) F(\mathbf{s})}}{\int d\mathbf{s} \, e^{- (\beta/\gamma) F(\mathbf{s})}} \]
</p>
<p> where \( \gamma \) is the so-called bias factor. It is possible to show that: </p><p class="formulaDsp">
\[ p(\mathbf{s}) = \frac{[ P(\mathbf{s}) ]^{1/\gamma}} {\int d\mathbf{s}\, [ P(\mathbf{s}) ]^{1/\gamma}} \]
</p>
<p> where \( P(\mathbf{s}) \) is the unbiased distribution of CVs. Therefore the target distribution is the unbiased distribution with enhanced fluctuations and lowered barriers. This is the same distribution as sampled in well-tempered metadynamics. The advantages of this distribution are that the features of the FES (metastable states) are preserved and that the system is not forced to sample regions of high free energy as it would if we had chosen the uniform target distribution. This is specially important when biasing 2 CVs and there are large regions of very high free energy and therefore they represent un-physical configurations.</p>
<p>There is a caveat though, \( p(\mathbf{s}) \) depends on \( F(\mathbf{s})\) that is the function that we are trying to calculate. One way to approach this problem is to calculate \( p(\mathbf{s}) \) self-consistently <a class="el" href="citelist.html#CITEREF_Valsson-JCTC-2015">[118]</a>, for instance at iteration \( k \): </p><p class="formulaDsp">
\[ p^{(k+1)}(\mathbf{s})=\frac{e^{-(\beta/\gamma) F^{(k+1)}(\mathbf{s})}}{\int d\mathbf{s} \, e^{-(\beta/\gamma) F^{(k+1)}(\mathbf{s})}} \]
</p>
<p> where: </p><p class="formulaDsp">
\[ F^{(k+1)}(\mathbf{s})=-V^{(k)}(\mathbf{s}) - \frac{1}{\beta} \log p^{(k)}(\mathbf{s}) \]
</p>
<p> Normally \( p^{(0)}(\mathbf{s}) \) is taken to be uniform. Therefore the target distribution evolves in time until it becomes stationary when the simulation has converged. It has been shown that in some cases the convergence is faster using the well-tempered target distribution than using the uniform \( p(\mathbf{s}) \) <a class="el" href="citelist.html#CITEREF_Valsson-JCTC-2015">[118]</a>.</p>
<h1><a class="anchor" id="ves-lugano2017-ves2-instructions"></a>
Instructions</h1>
<h2><a class="anchor" id="ves-lugano2017-ves2-subsection-1"></a>
The system</h2>
<p>We will consider the same system employed in previous tutorials.</p>
<h2><a class="anchor" id="ves-lugano2017-ves2-subsection-3"></a>
Example 1: Enhancing fluctuations</h2>
<p>We consider Example 2 of the VES 1 tutorial. In that case we used a uniform target distribution that at some value decayed to zero. In this case we will use a product of two distributions: </p><p class="formulaDsp">
\[ p(s)=\frac{p_{\mathrm{WT}}(s) \, p_{\mathrm{barrier}}(s)} {\int ds \, p_{\mathrm{WT}}(s) \, p_{\mathrm{barrier}}(s)} \]
</p>
<p> where \( p_{\mathrm{WT}}(s) \) is the well-tempered target distribution and:</p>
<p>MISSING EQUATION TO BE FIXED</p>
<p>with \( C \) a normalization factor. The files needed for this exercise are in the directory Example1. This target distribution can be specified in plumed using: </p>
<div style="width: 90%; float:left" id="value_details_eg1"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.7-incomplete-yellow.svg" alt="tested on v2.7" /></div><pre style="width: 97%;" class="fragment">
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/___f_i_l_l__.html" style="color:green">__FILL__</a> <span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg1td_uniform" onclick='showPath("eg1","eg1td_uniform")'>td_uniform: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_t_d__u_n_i_f_o_r_m.html" style="color:green">TD_UNIFORM</a> <div class="tooltip">MINIMA<div class="right">The minimum of the intervals where the target distribution is taken as uniform. <i></i></div></div>=0.23 <div class="tooltip">MAXIMA<div class="right">The maximum of the intervals where the target distribution is taken as uniform. <i></i></div></div>=0.6 <div class="tooltip">SIGMA_MAXIMA<div class="right">The standard deviation parameters of the Gaussian switching functions for the maximum
of the intervals. <i></i></div></div>=0.05 <span style="display:none;" id="eg1td_uniform"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg1td_welltemp" onclick='showPath("eg1","eg1td_welltemp")'>td_welltemp: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_t_d__w_e_l_l_t_e_m_p_e_r_e_d.html" style="color:green">TD_WELLTEMPERED</a> <div class="tooltip">BIASFACTOR<div class="right"><b>compulsory keyword </b>
The bias factor used for the well-tempered distribution. <i></i></div></div>=5 <span style="display:none;" id="eg1td_welltemp"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg1td_combination" onclick='showPath("eg1","eg1td_combination")'>td_combination: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_t_d__p_r_o_d_u_c_t__c_o_m_b_i_n_a_t_i_o_n.html" style="color:green">TD_PRODUCT_COMBINATION</a> <div class="tooltip">DISTRIBUTIONS<div class="right"><b>compulsory keyword </b>
The labels of the target distribution actions to be used in the product combination.
<i></i></div></div>=<b name="eg1td_uniform">td_uniform</b>,<b name="eg1td_welltemp">td_welltemp</b> <span style="display:none;" id="eg1td_combination"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg1b1" onclick='showPath("eg1","eg1b1")'>b1: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_v_e_s__l_i_n_e_a_r__e_x_p_a_n_s_i_o_n.html" style="color:green">VES_LINEAR_EXPANSION</a> ...
   <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=d1 
   <div class="tooltip">BASIS_FUNCTIONS<div class="right"><b>compulsory keyword </b>
the label of the one dimensional basis functions that should be used. <i></i></div></div>=bf1 
   
   <div class="tooltip">TEMP<div class="right">the system temperature - this is needed if the MD code does not pass the temperature
to PLUMED. <i></i></div></div>=300.0 
   <div class="tooltip">GRID_BINS<div class="right">the number of bins used for the grid. <i></i></div></div>=300 
   <div class="tooltip">TARGET_DISTRIBUTION<div class="right">the label of the target distribution to be used. <i></i></div></div>=<b name="eg1td_combination">td_combination</b> 
...<span style="display:none;" id="eg1b1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p> As usual, we run the example using the run.sh script. As the simulation progresses we can track the evolution of the target distribution. At variance with previous simulations where \( p(s) \) was stationary, in this case it evolves in time. The \( p(s) \) is dumped every 500 steps in a file named targetdist.b1.iter-&lt;iteration-number&gt;.data. You can plot these files manually or using the script plotTargetDistrib.gpi. The result should be similar to the following plot where the distribution at different times has been shifted to see more clearly the difference.</p>
<p><a class="anchor" id="ves-school-2017-ves2-targetDistrib"></a></p><div class="image">
<img src="ves-lugano2017-ves2_targetDistrib.png" alt=""/>
<div class="caption">
Evolution of the target distribution as the simulation progresses</div></div>
<p>To shed some light on the nature of the well-tempered target distribution, we will compare the unbiased and biased distribution of CVs. The unbiased distribution of CVs \( P(s) \) is calculated by constructing a histogram of the CVs with weights given by: </p><p class="formulaDsp">
\[ w(\mathbf{R}) \propto e^{\beta V(\mathbf{s})}. \]
</p>
<p> The biased distribution of CVs \( p&#39;(s) \) is calculated also by constructing a histogram of the CVs but in this case each point is assigned equal weights. The prime is added in \( p&#39;(s) \) to distinguish the biased distribution from the target distribution \( p(s) \). If the simulation has converged then \( p&#39;(s) = p(s) \). The files needed for this calculation are located in the Reweight directory. Since this simulation converges fast as compared to previous ones, we only disregard the first 1 ns of simulation: </p><pre class="fragment">sed '2,5000d' ../COLVAR &gt; COLVAR
</pre><p> To calculate the biased and unbiased distribution of CVs we use the following PLUMED input: </p>
<div style="width: 90%; float:left" id="value_details_eg2"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.7-incomplete-yellow.svg" alt="tested on v2.7" /></div><pre style="width: 97%;" class="fragment">
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/___f_i_l_l__.html" style="color:green">__FILL__</a> <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg2distance" onclick='showPath("eg2","eg2distance")'>distance: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_a_d.html" style="color:green">READ</a> <div class="tooltip">FILE<div class="right"><b>compulsory keyword </b>
the name of the file from which to read these quantities <i></i></div></div>=COLVAR <div class="tooltip">IGNORE_TIME<div class="right">( default=off ) ignore the time in the colvar file. <i></i></div></div> <div class="tooltip">VALUES<div class="right"><b>compulsory keyword </b>
the values to read from the file <i></i></div></div>=d1 <span style="display:none;" id="eg2distance"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg2ves" onclick='showPath("eg2","eg2ves")'>ves: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_a_d.html" style="color:green">READ</a> <div class="tooltip">FILE<div class="right"><b>compulsory keyword </b>
the name of the file from which to read these quantities <i></i></div></div>=COLVAR <div class="tooltip">IGNORE_TIME<div class="right">( default=off ) ignore the time in the colvar file. <i></i></div></div> <div class="tooltip">VALUES<div class="right"><b>compulsory keyword </b>
the values to read from the file <i></i></div></div>=b1.bias <span style="display:none;" id="eg2ves"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg2weights" onclick='showPath("eg2","eg2weights")'>weights: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_w_e_i_g_h_t__b_i_a_s.html" style="color:green">REWEIGHT_BIAS</a> <div class="tooltip">TEMP<div class="right">the system temperature. <i></i></div></div>=300 <div class="tooltip">ARG<div class="right"><b>compulsory keyword ( default=*.bias )</b>
the biases that must be taken into account when reweighting <i></i></div></div>=<b name="eg2ves">ves.bias</b> <span style="display:none;" id="eg2weights"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg2hh1" onclick='showPath("eg2","eg2hh1")'>hh1: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_h_i_s_t_o_g_r_a_m.html" style="color:green">HISTOGRAM</a> ...
   <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg2distance">distance</b> 
   <div class="tooltip">GRID_MIN<div class="right"><b>compulsory keyword </b>
the lower bounds for the grid <i></i></div></div>=0.23 
   <div class="tooltip">GRID_MAX<div class="right"><b>compulsory keyword </b>
the upper bounds for the grid <i></i></div></div>=0.8 
   <div class="tooltip">GRID_BIN<div class="right">the number of bins for the grid <i></i></div></div>=301 
   <div class="tooltip">BANDWIDTH<div class="right"><b>compulsory keyword </b>
the bandwidths for kernel density estimation <i></i></div></div>=0.006 
   
...<span style="display:none;" id="eg2hh1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg2hh2" onclick='showPath("eg2","eg2hh2")'>hh2: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_h_i_s_t_o_g_r_a_m.html" style="color:green">HISTOGRAM</a> ...
   <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg2distance">distance</b> 
   <div class="tooltip">GRID_MIN<div class="right"><b>compulsory keyword </b>
the lower bounds for the grid <i></i></div></div>=0.23 
   <div class="tooltip">GRID_MAX<div class="right"><b>compulsory keyword </b>
the upper bounds for the grid <i></i></div></div>=0.8 
   <div class="tooltip">GRID_BIN<div class="right">the number of bins for the grid <i></i></div></div>=301 
   <div class="tooltip">BANDWIDTH<div class="right"><b>compulsory keyword </b>
the bandwidths for kernel density estimation <i></i></div></div>=0.006 
   <div class="tooltip">LOGWEIGHTS<div class="right">list of actions that calculates log weights that should be used to weight configurations
when calculating averages <i></i></div></div>=<b name="eg2weights">weights</b> 
   
...<span style="display:none;" id="eg2hh2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_u_m_p_g_r_i_d.html" style="color:green">DUMPGRID</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the grid you would like to output <i></i></div></div>=<b name="eg2hh1">hh1</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword ( default=density )</b>
the file on which to write the grid. <i></i></div></div>=histo_biased <div class="tooltip">FMT<div class="right">the format that should be used to output real numbers <i></i></div></div>=%24.16e <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_u_m_p_g_r_i_d.html" style="color:green">DUMPGRID</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the grid you would like to output <i></i></div></div>=<b name="eg2hh2">hh2</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword ( default=density )</b>
the file on which to write the grid. <i></i></div></div>=histo_unbiased <div class="tooltip">FMT<div class="right">the format that should be used to output real numbers <i></i></div></div>=%24.16e <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p> If you do not understand what this input does, you might want to read once again the previous tutorials. The histograms histo_biased and histo_unbiased correspond to \( p&#39;(s) \) and \( P(s) \) , respectively. We are interested in comparing the unbiased distribution of CVs \( P(s) \) and the well-tempered distribution \( p_{\mathrm{WT}}(s)\). We know from the equations above that: </p><p class="formulaDsp">
\[ p_{\mathrm{WT}}(s) \propto [ P(\mathbf{s}) ]^{1/\gamma}, \]
</p>
<p> and also, </p><p class="formulaDsp">
\[ p_{\mathrm{WT}}(s) \propto p(s)/p_{\mathrm{barrier}}(s) \propto p&#39;(s)/p_{\mathrm{barrier}}(s) . \]
</p>
<p> Therefore we have two ways to calculate the well-tempered target distribution. We can compare \( P(s) \) and the well-tempered target distribution calculated in two ways with the following gnuplot lines: </p><pre class="fragment">biasFactor=5.
invBiasFactor=1./biasFactor
pl "./histo_unbiased" u 1:(-log($2)) w l title "P(s)"
repl "./histo_unbiased" u 1:(-log($2**invBiasFactor)) w l title "[P(s)]^(1/gamma)"
repl "&lt; paste ./histo_biased ../targetdist.b1.iter-0.data" u 1:(-log($2/$5)) w l title "Sampled p(s)"
</pre><p> There is also a gnuplot script plot.gpi that should do everything for you. The output should be similar to the next plot where we plot the negative logarithm of the distributions.</p>
<p><a class="anchor" id="ves-school-2017-ves2-well-tempered"></a></p><div class="image">
<img src="ves-lugano2017-ves2_well-tempered.png" alt=""/>
<div class="caption">
Unbiased distribution of CVs P(s) and well-tempered distribution calculated in two ways</div></div>
<p>Notice that as expected both equations to calculate \( p_{\mathrm{WT}}(s)\) agree. Also the association barrier of \( 5 \: k_{\mathrm{B}} T \) becomes of \( 1 \: k_{\mathrm{B}} T \) when the well-tempered target distribution is sampled.</p>
<p>The take home message of this tutorial is that when the well-tempered target distribution is employed, the biased distribution of CVs preserves all the features of the unbiased distribution, but barriers are lowered. Equivalently one may say that fluctuations are enhanced.</p>
<h2><a class="anchor" id="ves-lugano2017-ves2-subsection-4"></a>
Example 2: Constructing a 2 dimensional bias</h2>
<p>In this example we will construct a 2 dimensional bias on the distance Na-Cl and the coordination number of Na with respect to O. The files to run this example are included in the Example2 folder. Two dimensional biases in VES can be written: </p><p class="formulaDsp">
\[ V(s_1,s_2;\boldsymbol\alpha)=\sum\limits_{i_1,i_2} \alpha_{i_1,i_2} \, f_{i_1}(s_1)\, f_{i_2}(s_2) , \]
</p>
<p> where \( f_{i_1}(s_1)\) and \( f_{i_2}(s_2) \) are the basis functions. We will choose to expand the bias potential in Legendre polynomials up to order 20 in both dimensions. </p>
<div style="width: 90%; float:left" id="value_details_eg3"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.7-incomplete-yellow.svg" alt="tested on v2.7" /></div><pre style="width: 97%;" class="fragment">
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/___f_i_l_l__.html" style="color:green">__FILL__</a> <span style="display:none;" id="eg3"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># CV1</span>
<b name="eg3bf1" onclick='showPath("eg3","eg3bf1")'>bf1: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_b_f__l_e_g_e_n_d_r_e.html" style="color:green">BF_LEGENDRE</a> ...
   <div class="tooltip">ORDER<div class="right"><b>compulsory keyword </b>
The order of the basis function expansion. <i></i></div></div>=20 
   <div class="tooltip">MINIMUM<div class="right"><b>compulsory keyword </b>
The minimum of the interval on which the basis functions are defined. <i></i></div></div>=0.23 
   <div class="tooltip">MAXIMUM<div class="right"><b>compulsory keyword </b>
The maximum of the interval on which the basis functions are defined. <i></i></div></div>=0.8 
   
...<span style="display:none;" id="eg3bf1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># CV2</span>
<b name="eg3bf2" onclick='showPath("eg3","eg3bf2")'>bf2: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_b_f__l_e_g_e_n_d_r_e.html" style="color:green">BF_LEGENDRE</a> ...
   <div class="tooltip">ORDER<div class="right"><b>compulsory keyword </b>
The order of the basis function expansion. <i></i></div></div>=20 
   <div class="tooltip">MINIMUM<div class="right"><b>compulsory keyword </b>
The minimum of the interval on which the basis functions are defined. <i></i></div></div>=2.5 
   <div class="tooltip">MAXIMUM<div class="right"><b>compulsory keyword </b>
The maximum of the interval on which the basis functions are defined. <i></i></div></div>=7.5 
   
...<span style="display:none;" id="eg3bf2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p> We have chosen the interval [0.23,0.8] nm for the distance and [2.5,7.5] for the coordination number. The total number of non-zero coefficients will be 400. In the coefficients file the indices \(i_{1}\) and \(i_{2}\) are given by the first two columns. We use the well-tempered target distribution together with a barrier at 0.6 nm on the distance Na-Cl. </p>
<div style="width: 90%; float:left" id="value_details_eg4"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.7-incomplete-yellow.svg" alt="tested on v2.7" /></div><pre style="width: 97%;" class="fragment">
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/___f_i_l_l__.html" style="color:green">__FILL__</a> <span style="display:none;" id="eg4"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4td_uniform" onclick='showPath("eg4","eg4td_uniform")'>td_uniform: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_t_d__u_n_i_f_o_r_m.html" style="color:green">TD_UNIFORM</a> <div class="tooltip">MINIMA<div class="right">The minimum of the intervals where the target distribution is taken as uniform. <i></i></div></div>=0.2,2.5 <div class="tooltip">MAXIMA<div class="right">The maximum of the intervals where the target distribution is taken as uniform. <i></i></div></div>=0.6,7.5 <div class="tooltip">SIGMA_MAXIMA<div class="right">The standard deviation parameters of the Gaussian switching functions for the maximum
of the intervals. <i></i></div></div>=0.05,0.0 <span style="display:none;" id="eg4td_uniform"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4td_welltemp" onclick='showPath("eg4","eg4td_welltemp")'>td_welltemp: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_t_d__w_e_l_l_t_e_m_p_e_r_e_d.html" style="color:green">TD_WELLTEMPERED</a> <div class="tooltip">BIASFACTOR<div class="right"><b>compulsory keyword </b>
The bias factor used for the well-tempered distribution. <i></i></div></div>=5 <span style="display:none;" id="eg4td_welltemp"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4td_combination" onclick='showPath("eg4","eg4td_combination")'>td_combination: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_t_d__p_r_o_d_u_c_t__c_o_m_b_i_n_a_t_i_o_n.html" style="color:green">TD_PRODUCT_COMBINATION</a> <div class="tooltip">DISTRIBUTIONS<div class="right"><b>compulsory keyword </b>
The labels of the target distribution actions to be used in the product combination.
<i></i></div></div>=<b name="eg4td_uniform">td_uniform</b>,<b name="eg4td_welltemp">td_welltemp</b> <span style="display:none;" id="eg4td_combination"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4b1" onclick='showPath("eg4","eg4b1")'>b1: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_v_e_s__l_i_n_e_a_r__e_x_p_a_n_s_i_o_n.html" style="color:green">VES_LINEAR_EXPANSION</a> ...
   <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=d1,coord 
   <div class="tooltip">BASIS_FUNCTIONS<div class="right"><b>compulsory keyword </b>
the label of the one dimensional basis functions that should be used. <i></i></div></div>=bf1,bf2 
   
   <div class="tooltip">TEMP<div class="right">the system temperature - this is needed if the MD code does not pass the temperature
to PLUMED. <i></i></div></div>=300.0 
   <div class="tooltip">GRID_BINS<div class="right">the number of bins used for the grid. <i></i></div></div>=300,300 
   <div class="tooltip">TARGET_DISTRIBUTION<div class="right">the label of the target distribution to be used. <i></i></div></div>=<b name="eg4td_combination">td_combination</b> 
...<span style="display:none;" id="eg4b1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p> We can now run the simulation and control its progress. Since there are 400 coefficients we choose the largest (in absolute value) to control the convergence of the simulation. In this case we have chosen coefficients with indices \((i_{1},i_{2})\) as (1,0), (0,1), (1,1), (2,1), and (0,2). You can plot the evolution of the coefficients using the gnuplot script plotCoeffs.gpi. This plot should look similar to the following one. The bias therefore converges smoothly as in one dimensional problems.</p>
<p><a class="anchor" id="ves-school-2017-ves2-2d-coeffs"></a></p><div class="image">
<img src="ves-lugano2017-ves2_2D-coeffs.png" alt=""/>
<div class="caption">
Evolution of the largest coefficients</div></div>
<p>The estimated FES can also be plotted to control the progress of the simulation. For instance in gnuplot, </p><pre class="fragment">set xr [0.23:0.7]
set yr [3:7]
set zr [0:6]
set cbr [0:6]
set pm3d map
temp=2.494
spl "./fes.b1.iter-1000.data" u 1:2:($3/temp) w pm3d notitle
</pre><p> There is a gnuplot script plotFes.gpi that generates the following plot for the FES after 10 ns of simulation:</p>
<p><a class="anchor" id="ves-school-2017-ves2-2d-fes"></a></p><div class="image">
<img src="ves-lugano2017-ves2_2D-fes.png" alt=""/>
<div class="caption">
FES estimated from the 2D bias after 10 ns</div></div>
<p>This FES agrees with that calculated through reweighting in the metadynamics tutorial.</p>
<p>As an exercise, you can repeat this simulation using the uniform target distribution instead of the well-tempered \( p(s) \). Compare the convergence time of both simulations. Discuss the reasons why the algorithm converges faster to the well-tempered target distribution than to the uniform one. Does it make sense to sample all the CV space uniformly?</p>
<h1><a class="anchor" id="ves-lugano2017-ves2-final"></a>
Final remarks</h1>
<p>At this point the student has acquired experience with several characteristics of the VES method. There is one tool that has proven to be instrumental for many problems and that has not yet been discussed in this series of tutorials: the use of multiple walkers. This tool will be the subject of another tutorial. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="_add_mod.html">Additional Modules</a></li><li class="navelem"><a class="el" href="_v_e_s.html">Variationally Enhanced Sampling (VES code)</a></li><li class="navelem"><a class="el" href="ves_tutorials.html">Tutorials</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
