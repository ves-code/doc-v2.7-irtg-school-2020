<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>PLUMED: ESDW Workshop Lyon 2019: A very simple introduction to PLUMED</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script>
   var redpath = "";
   
   function showPath(eg,name) {
     var i; var y = document.getElementsByName(redpath);
     for (i=0; i < y.length; i++ ) { y[i].style.color="black"; }
     var x = document.getElementsByName(name); redpath=name;
     for (i = 0; i < x.length; i++) { x[i].style.color="red"; }
     var valid="value_details_".concat(eg);
     var valueField = document.getElementById(valid);
     var dataField = document.getElementById(name);
     valueField.innerHTML = dataField.innerHTML;
   }
   function swapInput(name) {
     var btn = document.getElementById(name + "_button");
     var mydiv = document.getElementById("input_" + name);
     if( btn.textContent=="expand shortcuts" ) {
         btn.textContent = "contract shortcuts";
         var dataField = document.getElementById(name + "long");
         mydiv.innerHTML = dataField.innerHTML;
     } else if( btn.textContent=="contract shortcuts" ) {
         btn.textContent = "expand shortcuts";
         var dataField = document.getElementById(name + "short");
         mydiv.innerHTML = dataField.innerHTML;
     }
   }
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.7b</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('lyon.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ESDW Workshop Lyon 2019: A very simple introduction to PLUMED </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="lyon-aims"></a>
Aims</h1>
<p>The aim of this tutorial is to give you a quick introduction to the PLUMED syntax and to some of the types of calculations that can be done with PLUMED. It was prepared for a two and a half hour session on PLUMED in the following CECAM extended software development workshop on topics in classical MD:</p>
<p><a href="https://www.cecam.org/workshop-1802.html">https://www.cecam.org/workshop-1802.html</a></p>
<p>This tutorial is very straightforward and not at all exhaustive. In fact it skims over many of the subtleties associated with performing these types of calculations using PLUMED. We have thus suggested additional topics that you might like to look into throughout the tutorial in order to take this further. <br  />
 If you are interested in using the techniques described in the tutorial in your own work a good starting point might be to read the chapter we wrote about using metadynamics from within PLUMED:</p>
<p><a href="https://arxiv.org/abs/1812.08213">https://arxiv.org/abs/1812.08213</a></p>
<h1><a class="anchor" id="lyon-objectives"></a>
Objectives</h1>
<p>Once this tutorial is completed students will be able to:</p>
<ul>
<li>Run simulations using the internal PLUMED MD engine simplemd.</li>
<li>Use PLUMED to add additional forces in order to prevent clusters from dissociating.</li>
<li>Use PLUMED to calculate and <a class="el" href="_p_r_i_n_t.html">PRINT</a> the value of a collective variable.</li>
<li>Use the PLUMED <a class="el" href="_h_i_s_t_o_g_r_a_m.html">HISTOGRAM</a> and <a class="el" href="_c_o_n_v_e_r_t__t_o__f_e_s.html">CONVERT_TO_FES</a> actions to calculate an estimate of the free energy as a function of some collective variables.</li>
<li>Run metadynamics using the action <a class="el" href="_m_e_t_a_d.html">METAD</a> in order to enhance sampling along collective variables of interest.</li>
</ul>
<h1><a class="anchor" id="lyon-resources"></a>
Resources</h1>
<p>The <span style="background-color:yellow"><a href="tutorial-resources/lyon.tar.gz" style="font-weight:bold" style="color:green" download="lyon.tar.gz">TARBALL</a> </span> for this project contains the following files:</p>
<ul>
<li>in : The input file for simplemd that contains the parameters for the MD simulation.</li>
<li>input.xyz : An initial configuration for the cluster that we are studying in this tutorial.</li>
<li>plumed.dat : An empty input file for PLUMED</li>
</ul>
<p>This tutorial has been tested on v2.5 but it should also work with other versions of PLUMED.</p>
<p>Also notice that the <code>.solutions</code> direction of the tarball contains correct input files for the exercises. Please only look at these files once you have tried to solve the problems yourself. Similarly the tutorial below contains questions for you to answer that are shown in bold. You can reveal the answers to these questions by clicking on links within the tutorial but you should obviously try to answer things yourself before reading these answers.</p>
<h1><a class="anchor" id="lyon-intro"></a>
Introduction</h1>
<p>In this tutorial we are going to study a very simple physical system; namely, seven Lennard Jones atoms in a two dimensional space. This simple system has been extensively studied as has often been used to benchmark new simulation techniques. In addition, the potential energy landscape has been fully characterized and it is known that only the four structurally-distinct minima shown below exist:</p>
<p><a class="anchor" id="lyon-lj7-minima"></a></p><div class="image">
<img src="lyon-lj7-minima.png" alt=""/>
<div class="caption">
The four energetic minima in the energy landscape for two-dimensional Lennard Jones 7.</div></div>
<p>In the exercises that follow we are going to learn how to use PLUMED to determine the relative free energies of these four structures by running molecular dynamics simulations. <br  />
</p>
<h1><a class="anchor" id="lyon-exercises"></a>
Exercises</h1>
<p>Before completing the following exercises you will need to download and install PLUMED. In addition, you will need to ensure that the PLUMED executable can be found within your path. <br  />
 You can download PLUMED from:</p>
<p><a href="http://www.plumed.org/get-it">http://www.plumed.org/get-it</a> or <a href="https://github.com/plumed/plumed2">https://github.com/plumed/plumed2</a></p>
<p>If you are running PLUMED on a Mac you can install the executable directly using macports and the command:</p>
<pre class="fragment">sudo port install plumed
</pre><p>If you download the source code you can find instructions on compilation in the PLUMED page on <a class="el" href="_installation.html">Installation</a>. If you run make install PLUMED or install with macports PLUMED will be within your path. <br  />
 If, however, you do not wish to do a make install you can simple make PLUMED. You can then add the location of the PLUMED executable to your path by issuing the command:</p>
<pre class="fragment">source sourceme.sh
</pre><p>from within the plumed2 directory.</p>
<h2><a class="anchor" id="lyon-simplemd"></a>
Using PLUMED as an MD code</h2>
<p>PLUMED is primarily used as a plugin to other larger molecular dynamics codes. Mainly for software testing and educational purposes, however, we do have an MD code with a rather limited set of options within PLUMED. You can run this code by issuing the command:</p>
<pre class="fragment">plumed simplemd &lt; in 
</pre><p>where in here is the input file from the tar ball for this tutorial, which is shown below:</p>
<pre class="fragment">nputfile input.xyz
outputfile output.xyz
temperature 0.5
tstep 0.005
friction 0.1
forcecutoff 2.5
listcutoff  3.0
ndim 2
nstep 200000
nconfig 1000 trajectory.xyz
nstat   1000 energies.dat
</pre><p>This input instructs PLUMED to perform 200000 steps of MD at a temperature of \(k_B T = 0.5 \epsilon\) starting from the configuration in input.xyz. The timestep in this simulation is 0.005 \(\sqrt{\epsilon}{m\sigma^2}\) and the temperature is kept fixed using a Langevin thermostat with a relaxation time of \(0.1 \sqrt{\epsilon}{m\sigma^2}\). Trajectory frames are output every 1000 MD steps to a file called trajectory.xyz. Notice also that in order to run the calculation above you need to provide an empty file called plumed.dat. This file is the input file to the PLUMED plugin itself, which, because this file is empty, is doing nothing when we run the calculation above.</p>
<p><b> Run a calculation using simplemd and the input above and visualize the trajectory that is output. Describe what happens during this calculation and explain why this is happening. </b></p>
<p> <details> <summary> <b> To learn more: What happens </b> </summary> <div class="hidden">  You can visualize what occurs during the trajectory by using a visualization package such as VMD (<a href="https://www.ks.uiuc.edu/Research/vmd/">https://www.ks.uiuc.edu/Research/vmd/</a>). If you are using VMD you can see the MD trajectory by using the command:</p>
<pre class="fragment">vmd trajectory.xyz
</pre><p>You should observe that all the atoms fly apart early on in the simulation and that the cluster evaporates. The cluster evaporates because at a temperature of \(k_B T = 0.5 \epsilon\) the gas state has a lower free energy than than the cluster state.  </div> </details>  <br  />
</p>
<p><b> Change the parameters in the input file for simplemd so as to prevent the cluster from evaporating. </b></p>
<p> <details> <summary> <b> To learn more: No evaporation </b> </summary> <div class="hidden">  To prevent the cluster from evaporating you need to lower the temperature in the file in. The cluster will not evaporate if the temperature is set equal to \(k_B T = 0.2 \epsilon\).  </div> </details> </p>
<h2><a class="anchor" id="lyon-force"></a>
Using PLUMED to specify a force field</h2>
<p>If we lower the temperature of the simulation very little will happen. Yes the cluster will no longer evaporate but at the same time we will not see any transitions between the various basins in this energy landscape. In this section we are thus going to see how we can use PLUMED to add a bias potential that can prevent the cluster from exploring gaseous configurations that do not interest us. In other words, we are going to see how we can use PLUMED to add restraints that will prevent the cluster from evaporating. Before getting on to that, however, we first need to understand a little about how the PLUMED input file works. As explained in <a class="el" href="trieste-1.html#trieste-1-structure">The structure of a PLUMED input file</a> and <a class="el" href="_syntax.html">Getting Started</a> when you write a PLUMED input file you are writing a script that calculates functions of the atomic positions. <br  />
</p>
<p><b> Read the description of the PLUMED input syntax in the linked pages in the paragraph above and then attempt the exercise that follows </b></p>
<p>We are going to prevent the cluster from evaporating by adding a restraint on all the atoms so as to prevent them from moving more than \(2\sigma\) from the center of mass of the cluster. As the masses of all the atoms in the cluster are the same we can compute the position of the center of mass using: </p><p class="formulaDsp">
\[ \mathbf{x}_\textrm{com} = \frac{1}{N} \sum_{i=1}^N \mathbf{x}_i \]
</p>
<p> where \(\mathbf{x}_i\) is the position of the \(i\)th atom. The distance between the \(i\)th atom and the position of this center of mass, \(d_i\), can be computed using Pythagoras' theorem. These distances are then restrained by using the following potential: </p><p class="formulaDsp">
\[ V(d_i) = \begin{cases} 100*(d_i-2.0)^2 &amp; \textrm{if} \quad d_i &gt; 2 \\ 0 &amp; \textrm{otherwise} \end{cases} \]
</p>
<p> as you can see this potential has no effect on the dynamics when these distances are less than 2 \(\epsilon\). If any atom is more than 2 \(\epsilon\) from the center of mass, however, this potential will drive it back towards the center of mass. The following cell contains a skeleton input file for PLUMED that gets it to calculate and apply this bias potential. <br  />
</p>

<div style="width: 90%; float:left" id="value_details_eg1"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.7-incomplete-yellow.svg" alt="tested on v2.7" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue"># this optional command tells VIM that this is a PLUMED file and to color the text accordingly</span>
<span style="color:blue"># vim: ft=plumed</span>
<span style="color:blue"># This tells PLUMED we are using Lennard Jones units</span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_u_n_i_t_s.html" style="color:green">UNITS</a> <div class="tooltip">NATURAL<div class="right">( default=off ) use natural units <i></i></div></div> <span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Calculate the position of the center of mass. We can then refer to this position later in the input using the label com.</span>
<b name="eg1com" onclick='showPath("eg1","eg1com")'>com: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_c_o_m.html" style="color:green">COM</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg1com"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Add the restraint on the distance between com and the first atom</span>
<b name="eg1d1" onclick='showPath("eg1","eg1d1")'>d1: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg1d1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_u_p_p_e_r__w_a_l_l_s.html" style="color:green">UPPER_WALLS</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg1d1">d1</b> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Add the restraint on the distance between com and the second atom</span>
<b name="eg1d2" onclick='showPath("eg1","eg1d2")'>d2: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg1d2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_u_p_p_e_r__w_a_l_l_s.html" style="color:green">UPPER_WALLS</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Add the restraint on the distance between com and the third atom</span>
<b name="eg1d3" onclick='showPath("eg1","eg1d3")'>d3: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg1d3"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_u_p_p_e_r__w_a_l_l_s.html" style="color:green">UPPER_WALLS</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Add the restraint on the distance between com and the fourth atom</span>
<b name="eg1d4" onclick='showPath("eg1","eg1d4")'>d4: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg1d4"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_u_p_p_e_r__w_a_l_l_s.html" style="color:green">UPPER_WALLS</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Add the restraint on the distance between com and the fifth atom</span>
<b name="eg1d5" onclick='showPath("eg1","eg1d5")'>d5: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg1d5"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_u_p_p_e_r__w_a_l_l_s.html" style="color:green">UPPER_WALLS</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Add the restraint on the distance between com and the sixth atom</span>
<b name="eg1d6" onclick='showPath("eg1","eg1d6")'>d6: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg1d6"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_u_p_p_e_r__w_a_l_l_s.html" style="color:green">UPPER_WALLS</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Add the restraint on the distance between com and the seventh atom</span>
<b name="eg1d7" onclick='showPath("eg1","eg1d7")'>d7: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg1d7"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_u_p_p_e_r__w_a_l_l_s.html" style="color:green">UPPER_WALLS</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p><b> Copy and paste the content above into the file plumed.dat and then fill in the blanks by looking up the documentation for these actions online and by reading the description of the calculation that you are to run above. Once you have got a working plumed.dat file run a calculation using simplemd again at a temperature of \(k_B T = 0.2 \epsilon\) and check to see if the bias potential is indeed preventing the cluster from evaporating. </b></p>
<h3><a class="anchor" id="lyon-ex0-ext"></a>
Extensions</h3>
<p>Try the following exercises if you have time and if you wish to take this exercise further:</p>
<ul>
<li>See if you can rewrite the input above in a more compact way by making use of <a class="el" href="_d_i_s_t_a_n_c_e_s.html">DISTANCES</a> and <a class="el" href="_u_w_a_l_l_s.html">UWALLS</a>.</li>
<li>Checkout the hack-the-tree branch of PLUMED. This version of PLUMED allows you to pass vector quantities between actions as well as scalars. See if you can rewrite the above input using this version of PLUMED by making use of the <a class="el" href="_m_a_t_h_e_v_a_l.html">MATHEVAL</a> and <a class="el" href="_b_i_a_s_v_a_l_u_e.html">BIASVALUE</a> actions.</li>
</ul>
<h2><a class="anchor" id="lyon-ex1"></a>
Calculating collective variables</h2>
<p>We can easily determine if there are transitions between the four possible minima in the Lennard-Jones-seven potential energy landscape by monitoring the second and third central moments of the distribution of coordination numbers. The \(n\)th central moment of a set of numbers, \(\{X_i\}\) can be calculated using: </p><p class="formulaDsp">
\[ \mu^n = \frac{1}{N} \sum_{i=1}^N ( X_i - \langle X \rangle )^n \qquad \textrm{where} \qquad \langle X \rangle = \frac{1}{N} \sum_{i=1}^N X_i \]
</p>
<p> Furthermore, we can compute the coordination number of our Lennard Jones atoms using: </p><p class="formulaDsp">
\[ c_i = \sum_{i \ne j } \frac{1 - \left(\frac{r_{ij}}{1.5}\right)^8}{1 - \left(\frac{r_{ij}}{1.5}\right)^{16} } \]
</p>
<p> where \(r_{ij}\)__FILL__ is the distance between atom \(i\) and atom \(j\). The following cell contains a skeleton input file for PLUMED that gets it to calculate and print the values these two quantities take every 100 time steps to a file called colvar.</p>

<div style="width: 90%; float:left" id="value_details_eg2"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.7-incomplete-yellow.svg" alt="tested on v2.7" /></div><pre style="width: 97%;" class="fragment">
<b name="eg2c1" onclick='showPath("eg2","eg2c1")'>c1: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_c_o_o_r_d_i_n_a_t_i_o_n_n_u_m_b_e_r.html" style="color:green">COORDINATIONNUMBER</a> <div class="tooltip">SPECIES<div class="right">this keyword is used for colvars such as coordination number. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">MOMENTS<div class="right">calculate the moments of the distribution of collective variables. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">SWITCH<div class="right">This keyword is used if you want to employ an alternative to the continuous switching
function defined above. <i></i></div></div>={RATIONAL __FILL__ }  <span style="display:none;" id="eg2c1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=colvar <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=100 <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p><b> Copy and paste the content above into your plumed.dat file after the lines that you added in the previous exercise that added the restraints to stop the cluster from evaporating. Fill in the blanks in the input above and, once you have a working plumed.dat file, run a calculation using simplemd at a temperature of \(k_B T = 0.2 \epsilon\). Once you have generated the trajectory plot the time series of second and third moment values using gnuplot or some other plotting package. </b></p>
<p> <details> <summary> <b> To learn more: Example time series </b> </summary> <div class="hidden"> </p>
<p><a class="anchor" id="lyon-time-series"></a></p><div class="image">
<img src="lyon-time-series.png" alt=""/>
<div class="caption">
Time series for the second and third moments of the distribution of coordination numbers for two trajectories of Lennard Jones 7. The time series on the left was computed from a trajectory that was performed at a temperature of 0.2, while the two time series on the right were computed at a temperature of 0.1. You can see that at the higher temperature there are jumps between distinct minima in the energy landscape. At the lower temperature, however, the system remains trapped in a single basin in the energy lanscape</div></div>
<p> </div> </details> </p>
<h3><a class="anchor" id="lyon-ex1-ext"></a>
Extensions</h3>
<p>Try the following exercises if you have time and if you wish to take this exercise further:</p>
<ul>
<li>Investigate how <a class="el" href="_s_p_r_i_n_t.html">SPRINT</a> coordinates are defined and calculated using PLUMED and try to compute them for this particular system.</li>
<li>Read about other collective variables that can be calculated using PLUMED. A topic that is particularly important to understand is how PLUMED deals with periodic boundary conditions.</li>
</ul>
<h2><a class="anchor" id="lyon-ex2"></a>
Estimating the free energy surface</h2>
<p>When you plotted the time series for the collective variables in the previous exercise you should have seen that the values of these collective variables fluctuate around a number of different constant values for long periods of time. There are then infrequent jumps and after these jumps the value of the collective variable settles down and begins to fluctuate around a different constant value. There are jumps in the value of the CV whenever the system moves from one minimums illustrated above to another. What we would ideally like to extract from our simulation are the relative free energies of these various minimums. From elementary statistical mechanics, however, we know that the free energy is given by: </p><p class="formulaDsp">
\[ F(s) = -k_B T \ln P(s) \]
</p>
<p> Consequently, if we can extract an estimate of the probability that the CVs take particular values, \(s\), then we can get an estimate of the free energy. Extracting an estimate that for the probability that the collective variables take a particular value is easy, however. We just need to construct a histogram from the CV values that the system took during the trajectory. The following cell contains a skeleton input file for PLUMED that gets it to estimate this histogram and that converts and outputs this estimate of the histogram to a file called fes.dat.</p>

<div style="width: 90%; float:left" id="value_details_eg3"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.7-incomplete-yellow.svg" alt="tested on v2.7" /></div><pre style="width: 97%;" class="fragment">
<b name="eg3hh" onclick='showPath("eg3","eg3hh")'>hh: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_h_i_s_t_o_g_r_a_m.html" style="color:green">HISTOGRAM</a> <span style="background-color:yellow">__FILL__</span><div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=-1.0,-1.0 <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=1.5,1.5 <div class="tooltip">GRID_BIN<div class="right">the number of bins for the grid <i></i></div></div>=300,300 <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=DISCRETE <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the data should be collected and added to the quantity being
averaged <i></i></div></div>=100 <span style="display:none;" id="eg3hh"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3fes" onclick='showPath("eg3","eg3fes")'>fes: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_c_o_n_v_e_r_t__t_o__f_e_s.html" style="color:green">CONVERT_TO_FES</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the input grid you would like to use <i></i></div></div>=_FILL__ <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=0.2 <span style="display:none;" id="eg3fes"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_u_m_p_g_r_i_d.html" style="color:green">DUMPGRID</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the grid you would like to output <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">FILE<div class="right"><b>compulsory keyword ( default=density )</b>
the file on which to write the grid. <i></i></div></div>=<b name="eg3fes">fes.dat</b> <span style="display:none;" id="eg3"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p><b> Copy and paste the content above into your plumed.dat file after the lines that you added in the previous two exercises. Fill in the blanks in the input above and, once you have a working plumed.dat file, run a calculation using simplemd at a temperature of \(k_B T = 0.2 \epsilon\). Once you have generated the trajectory create a contour plot of the free energy surface that is contained in fes.dat using gnuplot or some other plotting package. </b></p>
<p> <details> <summary> <b> To learn more: What your free energy surface should look like </b> </summary> <div class="hidden">  The free energy surface that you get from this calculation should look something like the figure shown on the left below. Please note that in order to fully sample configuration space and in order to get a reasonably converged estimate of the free energy you are going to have to use many more time steps than you did in previous exercises. The figure shown on the right is the free energy surface obtained if you run at a temperature of \(k_B T = 0.1 \epsilon\). As you can see a much smaller volume of configuration space is explored at this lower temperature</p>
<p><a class="anchor" id="lyon-lj7-fes"></a></p><div class="image">
<img src="lyon-histograms-highT.png" alt=""/>
<div class="caption">
The free energy for Lennard Jones seven calculated by computing a histogram based on an MD trajectory at a temperature of 0.2 (left) and at a temperature of 0.1.</div></div>
<p> </div> </details> </p>
<p><b> Rerun the calculation of the free energy surface at a lower temperature. What differences do you observe at the lower temperature? Why might these differences be problematic? </b></p>
<p> <details> <summary> <b> To learn more: Running at a lower temperature </b> </summary> <div class="hidden">  When you run the simulation at a lower temperature you should see that the system no longer explores all the basins in the free energy landscape. If the temperature is sufficiently low the system will remain trapped in the original configuration throughout the whole simulation run. At very low temperatures this may be the correct behavior and the free energy estimate you obtain may prove to be a reasonable estimate. At the same time, however, lowering the temperature makes the barrier crossing a rarer event. It thus becomes less likely that you will observe a crossing between basins in a lower temperature simulation. The fact that the histogram shows that the probability of observing these configurations is zero may thus simply be a consequence of the fact that the simulation is not converged. The free energy will thus look like the one shown below instead of looking like the one in the previous hidden section:</p>
<p><a class="anchor" id="lyon-lj7-fes2"></a></p><div class="image">
<img src="lyon-histograms-lowT.png" alt=""/>
<div class="caption">
The free energy for Lennard Jones seven calculated by computing a histogram based on an MD trajectory at a temperature of 0.2 (left) and at a temperature of 0.1.</div></div>
<p> </div> </details> </p>
<h3><a class="anchor" id="lyon-ex2-ext"></a>
Extensions</h3>
<p>Try the following exercises if you have time and if you wish to take this exercise further:</p>
<ul>
<li>Try to recalculate the free energy surface but use kernel density estimation when calculating the <a class="el" href="_h_i_s_t_o_g_r_a_m.html">HISTOGRAM</a>.</li>
<li>Work through <a class="el" href="trieste-2.html">Trieste tutorial: Averaging, histograms and block analysis</a> and try to apply the ideas this tutorial covers to calculate appropriate error bars the estimate of the free energy surface that you extracted in the previous exercises.</li>
</ul>
<h2><a class="anchor" id="lyon-ex3"></a>
Performing metadynamics</h2>
<p>We can use an enhanced sampling algorithm to overcome the problems that we encountered at the end of the last exercise and to more fully explore configuration space even at low temperature. In this final exercise we are thus going to perform a metadynamics simulation on our Lennard Jones cluster. In metadynamics the system is forced to explore more of configuration space by a history dependent bias that has the following functional form: </p><p class="formulaDsp">
\[ V(s,t) = \sum_{\tau=0}^t w(\tau) \exp\left( -\frac{( s(t) - s(\tau))^2 }{ 2\sigma^2} \right) \]
</p>
<p> This bias potential consists of a sum of Gaussian kernels with bandwidth \(\sigma\) that are centered at the values of the CV that the system took at previous times. The weights of the kernels in this sum are time dependent because we are going to use the well-tempered variant of metadynamics which introduces one further parameter \(\gamma = \frac{T + \Delta T}{T}\). <br  />
</p>
<p>To run metadynamics on the Lennard Jones cluster that we have been studying in this exercise using PLUMED you would delete the lines that you used to compute the histogram from the plumed input file that we have been using thus far and you would add a line like the one shown below.</p>

<div style="width: 90%; float:left" id="value_details_eg4"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.7-incomplete-yellow.svg" alt="tested on v2.7" /></div><pre style="width: 97%;" class="fragment">
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_m_e_t_a_d.html" style="color:green">METAD</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">HEIGHT<div class="right">the heights of the Gaussian hills. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">PACE<div class="right"><b>compulsory keyword </b>
the frequency for hill addition <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">SIGMA<div class="right"><b>compulsory keyword </b>
the widths of the Gaussian hills <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">GRID_MIN<div class="right">the lower bounds for the grid <i></i></div></div>=-1.5,-1.5 <div class="tooltip">GRID_MAX<div class="right">the upper bounds for the grid <i></i></div></div>=2.5,2.5 <div class="tooltip">GRID_BIN<div class="right">the number of bins for the grid <i></i></div></div>=500,500 <div class="tooltip">BIASFACTOR<div class="right">use well tempered metadynamics and use this bias factor. <i></i></div></div>=5 <span style="display:none;" id="eg4"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p><b> This input should be modified to instruct PLUMED to add Gaussian kernels with a bandwidth of 0.1 in both the second and third moment of the distribution of coordination numbers and a height of 0.05 \(\epsilon\) every 50 MD steps. The metadynamics calculation should then be run using simplemd at a temperature of \(k_B T = 0.1 \epsilon\). </b></p>
<p>A nice feature of the metadynamics method is that, if the simulation is converged, the final bias potential is a related to the underlying free energy surface by: </p><p class="formulaDsp">
\[ F(s) = - \frac{T + \Delta T}{\Delta T} V(s,t) \]
</p>
<p> This formula is implemented in the tool sum_hills that is part of the PLUMED package. To run sum_hills on the output of your metadynamics simulation you can run the command:</p>
<pre class="fragment">plumed sum_hills --hills HILLS
</pre><p>This command should output a file called fes.dat that contains the final estimate of the free energy surface that was calculated using metadynamics.</p>
<p><b> Try to run the sum_hills command on the HILLS file output by your metadynamics simulation. Visualize the fes.dat file that is output by using gnuplot or some similar plotting package. </b></p>
<h3><a class="anchor" id="lyon-ex3-ext"></a>
Extensions</h3>
<p>Try the following exercises if you have time and if you wish to take this exercise further:</p>
<ul>
<li>Work through <a class="el" href="trieste-2.html">Trieste tutorial: Averaging, histograms and block analysis</a> and try to apply the ideas this tutorial covers to calculate an estimate of the free energy surface using metadynamics and reweighting.</li>
<li>Try to estimate the errors on your estimate of the free energy surface.</li>
</ul>
<h1><a class="anchor" id="lyon-conclusions"></a>
Conclusions</h1>
<p>This exercise has hopefully given you a sense of the sorts of calculations that can be performed using PLUMED. Hopefully you now have an understanding of how PLUMED input files are structured so that variables can be passed between different actions. Furthermore, you should have seen how PLUMED can be used both to analyze trajectories and to add in additional forces that force the system to undergo transitions that it would not otherwise undergo.</p>
<p>Obviously, given the short time available to us in this tutorial, we have only scratched the surface in terms of what PLUMED can be used to do and in terms of how metadynamics calculations are run in practice. If you want to understand more about how to run PLUMED we would recommend that you start by reading the chapter that we provided a link to in the introduction to this tutorial. For now though well done on completing the exercise and good luck with your future PLUMED-related endeavors. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
