<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>PLUMED: Lugano tutorial: Using restraints</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script>
   var redpath = "";
   
   function showPath(eg,name) {
     var i; var y = document.getElementsByName(redpath);
     for (i=0; i < y.length; i++ ) { y[i].style.color="black"; }
     var x = document.getElementsByName(name); redpath=name;
     for (i = 0; i < x.length; i++) { x[i].style.color="red"; }
     var valid="value_details_".concat(eg);
     var valueField = document.getElementById(valid);
     var dataField = document.getElementById(name);
     valueField.innerHTML = dataField.innerHTML;
   }
   function swapInput(name) {
     var btn = document.getElementById(name + "_button");
     var mydiv = document.getElementById("input_" + name);
     if( btn.textContent=="expand shortcuts" ) {
         btn.textContent = "contract shortcuts";
         var dataField = document.getElementById(name + "long");
         mydiv.innerHTML = dataField.innerHTML;
     } else if( btn.textContent=="contract shortcuts" ) {
         btn.textContent = "expand shortcuts";
         var dataField = document.getElementById(name + "short");
         mydiv.innerHTML = dataField.innerHTML;
     }
   }
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.7b</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('lugano-2.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Lugano tutorial: Using restraints </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="lugano-2-aims"></a>
Aims</h1>
<p>The aim of this tutorial is to introduce the users to the use of constant biases in PLUMED and their application to perform a simple Umbrella Sampling WHAM simulation.</p>
<h1><a class="anchor" id="lugano-2-objectives"></a>
Objectives</h1>
<ul>
<li>Apply a restraint on a simulations over one or more collective variables</li>
<li>Understand the effect of a restraint on the acquired statistics</li>
<li>Perform a simple un-biasing of a restrained simulation</li>
<li>Add an external potential in the form of an analytical or numerical function</li>
<li>Perform an Umbrella Sampling WHAM simulation</li>
</ul>
<h1><a class="anchor" id="lugano-2-resources"></a>
Resources</h1>
<p>The <span style="background-color:yellow"><a href="tutorial-resources/lugano-2.tar.gz" style="font-weight:bold" style="color:green" download="lugano-2.tar.gz">TARBALL</a> </span> for this tutorial contains the following files:</p><ul>
<li>diala.pdb: a PDB file for alanine dipeptide in vacuo</li>
<li>topol.tpr: a GROMACS run file to perform MD of alanine dipeptide</li>
<li>run_us.sh: a script to perform a serial US wham simulation</li>
<li>wham.py: a script to perform the WHAM analysis</li>
<li>do_fes.py: a script to generate fes from CV and weights</li>
</ul>
<p>Also notice that the <code>.solutions</code> direction of the tarball contains correct input files for the exercises. This tutorial has been tested with version 2.5.</p>
<h1><a class="anchor" id="lugano-2-intro"></a>
Introduction</h1>
<p>PLUMED can calculate conformational properties of a system a posteriori as well as on-the-fly. This information can be use to manipulate a simulation on-the-fly. This means adding energy terms in addition to those of the original Hamiltonian. This additional energy terms are usually referred as <a class="el" href="_bias.html">Bias</a>. In the following we will see how to apply a constant bias potential with PLUMED. It is preferable to run each exercise in a separate folder.</p>
<p> <details> <summary> <b> To learn more: Summary of theory </b> </summary> <div class="hidden">  </p>
<h2><a class="anchor" id="lugano-2-theory-biased-sampling"></a>
Biased sampling</h2>
<p>A system at temperature \( T\) samples conformations from the canonical ensemble: </p><p class="formulaDsp">
\[ P(q)\propto e^{-\frac{U(q)}{k_BT}} \]
</p>
<p>. Here \( q \) are the microscopic coordinates and \( k_B \) is the Boltzmann constant. Since \( q \) is a highly dimensional vector, it is often convenient to analyze it in terms of a few collective variables (see <a class="el" href="lugano-1.html">Lugano tutorial: Brief guide to PLUMED syntax and analyzing trajectories</a> ). The probability distribution for a CV \( s\) is </p><p class="formulaDsp">
\[ P(s)\propto \int dq e^{-\frac{U(q)}{k_BT}} \delta(s-s(q)) \]
</p>
<p> This probability can be expressed in energy units as a free energy landscape \( F(s) \): </p><p class="formulaDsp">
\[ F(s)=-k_B T \log P(s) \]
</p>
<p>.</p>
<p>Now we would like to modify the potential by adding a term that depends on the CV only. That is, instead of using \( U(q) \), we use \( U(q)+V(s(q))\). There are several reasons why one would like to introduce this potential. One is to avoid that the system samples some un-desired portion of the conformational space. As an example, imagine that you want to study dissociation of a complex of two molecules. If you perform a very long simulation you will be able to see association and dissociation. However, the typical time required for association will depend on the size of the simulation box. It could be thus convenient to limit the exploration to conformations where the distance between the two molecules is lower than a given threshold. This could be done by adding a bias potential on the distance between the two molecules. Another example is the simulation of a portion of a large molecule taken out from its initial context. The fragment alone could be unstable, and one might want to add additional potentials to keep the fragment in place. This could be done by adding a bias potential on some measure of the distance from the experimental structure (e.g. on root-mean-square deviation).</p>
<p>Whatever CV we decide to bias, it is very important to recognize which is the effect of this bias and, if necessary, remove it a posteriori. The biased distribution of the CV will be </p><p class="formulaDsp">
\[ P&#39;(s)\propto \int dq e^{-\frac{U(q)+V(s(q))}{k_BT}} \delta(s-s(q))\propto e^{-\frac{V(s(q))}{k_BT}}P(s) \]
</p>
<p> and the biased free energy landscape </p><p class="formulaDsp">
\[ F&#39;(s)=-k_B T \log P&#39;(s)=F(s)+V(s)+C \]
</p>
<p> Thus, the effect of a bias potential on the free energy is additive. Also notice the presence of an undetermined constant \( C \). This constant is irrelevant for what concerns free-energy differences and barriers, but will be important later when we will learn the weighted-histogram method. Obviously the last equation can be inverted so as to obtain the original, unbiased free-energy landscape from the biased one just subtracting the bias potential </p><p class="formulaDsp">
\[ F(s)=F&#39;(s)-V(s)+C \]
</p>
<p>Additionally, one might be interested in recovering the distribution of an arbitrary observable. E.g., one could add a bias on the distance between two molecules and be willing to compute the unbiased distribution of some torsional angle. In this case there is no straightforward relationship that can be used, and one has to go back to the relationship between the microscopic probabilities: </p><p class="formulaDsp">
\[ P(q)\propto P&#39;(q) e^{\frac{V(s(q))}{k_BT}} \]
</p>
<p> The consequence of this expression is that one can obtained any kind of unbiased information from a biased simulation just by weighting every sampled conformation with a weight </p><p class="formulaDsp">
\[ w\propto e^{\frac{V(s(q))}{k_BT}} \]
</p>
<p> That is, frames that have been explored in spite of a high (disfavoring) bias potential \( V \) will be counted more than frames that has been explored with a less disfavoring bias potential.</p>
<p> </div> </details> </p>
<p>We will make use as a toy-model of alanine dipeptide: we will see how we can use an iterative approach to build a constant bias to speed up the sampling.</p>
<dl class="section note"><dt>Note</dt><dd>Create a folder for each exercise and use sub-folders if you want to run the same simulation with multiple choices for the parameters</dd></dl>
<h1><a class="anchor" id="lugano-2-ex-1"></a>
Exercise 1: Preliminary run with alanine dipeptide</h1>
<p>Alanine dipeptide is characterized by multiple minima separated by relatively high free energy barriers. Here we will explore the conformational space of alanine dipeptide using a standard MD simulation, then instead of using the free energy as an external potential we will try to fit the potential using gnuplot and add a bias using an analytical function of a collective variable with <a class="el" href="_c_u_s_t_o_m.html">CUSTOM</a> and <a class="el" href="_b_i_a_s_v_a_l_u_e.html">BIASVALUE</a> .</p>
<p>As a first test lets run an MD and generate on-the-fly the free energy as a function of the phi and psi collective variables separately.</p>
<p>This is an example input file to calculate the phi and psi angles on the fly and accumulate two 1D histograms from which calculating the free energy.</p>

<div style="width: 90%; float:left" id="value_details_eg1"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.7-passing-green.svg" alt="tested on v2.7" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue">#SETTINGS MOLFILE=user-doc/tutorials/lugano-2/diala.pdb</span>
<span style="color:blue"># vim:ft=plumed</span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <div class="tooltip">STRUCTURE<div class="right"><b>compulsory keyword </b>
a file in pdb format containing a reference structure. <i></i></div></div>=diala.pdb <span style="display:none;" id="eg1">The MOLINFO action with label <b></b></span>
<b name="eg1phi" onclick='showPath("eg1","eg1phi")'>phi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=@phi-2 <span style="display:none;" id="eg1phi">The TORSION action with label <b>phi</b> calculates a single scalar value</span>
<b name="eg1psi" onclick='showPath("eg1","eg1psi")'>psi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=@psi-2 <span style="display:none;" id="eg1psi">The TORSION action with label <b>psi</b> calculates a single scalar value</span>
<b name="eg1hhphi" onclick='showPath("eg1","eg1hhphi")'>hhphi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_h_i_s_t_o_g_r_a_m.html" style="color:green">HISTOGRAM</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg1phi">phi</b> <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the data should be collected and added to the quantity being
averaged <i></i></div></div>=50 <div class="tooltip">GRID_MIN<div class="right"><b>compulsory keyword </b>
the lower bounds for the grid <i></i></div></div>=-pi <div class="tooltip">GRID_MAX<div class="right"><b>compulsory keyword </b>
the upper bounds for the grid <i></i></div></div>=pi <div class="tooltip">GRID_BIN<div class="right">the number of bins for the grid <i></i></div></div>=600 <div class="tooltip">BANDWIDTH<div class="right"><b>compulsory keyword </b>
the bandwidths for kernel density estimation <i></i></div></div>=0.1 <span style="display:none;" id="eg1hhphi">The HISTOGRAM action with label <b>hhphi</b></span>
<b name="eg1hhpsi" onclick='showPath("eg1","eg1hhpsi")'>hhpsi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_h_i_s_t_o_g_r_a_m.html" style="color:green">HISTOGRAM</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg1psi">psi</b> <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the data should be collected and added to the quantity being
averaged <i></i></div></div>=50 <div class="tooltip">GRID_MIN<div class="right"><b>compulsory keyword </b>
the lower bounds for the grid <i></i></div></div>=-pi <div class="tooltip">GRID_MAX<div class="right"><b>compulsory keyword </b>
the upper bounds for the grid <i></i></div></div>=pi <div class="tooltip">GRID_BIN<div class="right">the number of bins for the grid <i></i></div></div>=600 <div class="tooltip">BANDWIDTH<div class="right"><b>compulsory keyword </b>
the bandwidths for kernel density estimation <i></i></div></div>=0.1 <span style="display:none;" id="eg1hhpsi">The HISTOGRAM action with label <b>hhpsi</b></span>
<b name="eg1ffphi" onclick='showPath("eg1","eg1ffphi")'>ffphi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_c_o_n_v_e_r_t__t_o__f_e_s.html" style="color:green">CONVERT_TO_FES</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the input grid you would like to use <i></i></div></div>=<b name="eg1hhphi">hhphi</b> <span style="display:none;" id="eg1ffphi">The CONVERT_TO_FES action with label <b>ffphi</b></span>
<b name="eg1ffpsi" onclick='showPath("eg1","eg1ffpsi")'>ffpsi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_c_o_n_v_e_r_t__t_o__f_e_s.html" style="color:green">CONVERT_TO_FES</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the input grid you would like to use <i></i></div></div>=<b name="eg1hhpsi">hhpsi</b> <span style="display:none;" id="eg1ffpsi">The CONVERT_TO_FES action with label <b>ffpsi</b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_u_m_p_g_r_i_d.html" style="color:green">DUMPGRID</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the grid you would like to output <i></i></div></div>=<b name="eg1ffphi">ffphi</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword ( default=density )</b>
the file on which to write the grid. <i></i></div></div>=fes_phi <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=0 )</b>
the frequency with which the grid should be output to the file. <i></i></div></div>=100000 <span style="display:none;" id="eg1">The DUMPGRID action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_u_m_p_g_r_i_d.html" style="color:green">DUMPGRID</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the grid you would like to output <i></i></div></div>=<b name="eg1ffpsi">ffpsi</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword ( default=density )</b>
the file on which to write the grid. <i></i></div></div>=fes_psi <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=0 )</b>
the frequency with which the grid should be output to the file. <i></i></div></div>=100000 <span style="display:none;" id="eg1">The DUMPGRID action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg1phi">phi</b>,<b name="eg1psi">psi</b> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=colvar.dat <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=50 <span style="display:none;" id="eg1">The PRINT action with label <b></b></span>
</pre>
<p>run it with gromacs as</p>
<pre class="fragment">gmx mdrun -s topol -plumed plumed.dat -nb cpu -v
</pre><p>from the colvar file it is clear that we can quickly explore two minima but that the region for positive phi is not accessible. Ideally we would like to speed up the sampling of regions that are not visited spontaneously by MD. We have multiple possibilities. One option could be to use as a bias the opposite of the accumulated free-energy using <a class="el" href="_e_x_t_e_r_n_a_l.html">EXTERNAL</a> . Another option can be to fit the FES and use the fit. This is what we will do, but first of all take a look at the fes accumulated in time.</p>
<pre class="fragment">&gt;gnuplot
plot for [i=0:9] 'analysis.'.i.'.fes_phi' u 1:2 w l t''.i
rep 'fes_phi' u 1:2 w l t'final'
plot for [i=0:9] 'analysis.'.i.'.fes_psi' u 1:2 w l t''.i
rep 'fes_psi' u 1:2 w l t'final'
</pre><p>So first we need to fit the opposite of the free energy as a function of phi in the region explored with a periodic function, because of the gaussian like look of the minima we can fit it using <a href="https://en.wikipedia.org/wiki/Von_Mises_distribution">the von Mises distribution</a>. In gnuplot</p>
<pre class="fragment">&gt;gnuplot
gnuplot&gt;plot 'fes_phi' u 1:(-$2) w l
</pre><p>Now find a value such as the fes is always positive, e.g. ~38</p>
<pre class="fragment">gnuplot&gt;plot 'fes_phi' u 1:(-$2+38) w l
gnuplot&gt;f(x)=exp(k1*cos(x-a1))+exp(k2*cos(x-a2))
gnuplot&gt;k1=2
gnuplot&gt;k2=2
gnuplot&gt;fit [-2.9:-0.7] f(x) 'fes_phi' u 1:(-$2+38) via k1,a1,k2,a2
gnuplot&gt;rep f(x)
</pre><p>The function and the resulting parameters can be used to run a new biased simulation:</p>
<h1><a class="anchor" id="lugano-2-ex-2"></a>
Exercise 2: First biased run with alanine dipeptide</h1>
<p>To the above file we add a few lines to define using <a class="el" href="_c_u_s_t_o_m.html">CUSTOM</a> a function of the angle phi.</p>

<div style="width: 90%; float:left" id="value_details_eg2"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.7-incomplete-yellow.svg" alt="tested on v2.7" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue">#SETTINGS MOLFILE=user-doc/tutorials/lugano-2/diala.pdb</span>
<span style="color:blue"># vim:ft=plumed</span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <div class="tooltip">STRUCTURE<div class="right"><b>compulsory keyword </b>
a file in pdb format containing a reference structure. <i></i></div></div>=diala.pdb <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg2phi" onclick='showPath("eg2","eg2phi")'>phi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=@phi-2 <span style="display:none;" id="eg2phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg2psi" onclick='showPath("eg2","eg2psi")'>psi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=@psi-2 <span style="display:none;" id="eg2psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg2doubleg" onclick='showPath("eg2","eg2doubleg")'>doubleg: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_c_u_s_t_o_m.html" style="color:green">CUSTOM</a> ...
   <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg2phi">phi</b> 
   
   <div class="tooltip">FUNC<div class="right"><b>compulsory keyword </b>
the function you wish to evaluate <i></i></div></div>=exp(__FILL__*cos(x-__FILL__))+exp(__FILL__*cos(x-__FILL__)) 
   <div class="tooltip">PERIODIC<div class="right"><b>compulsory keyword </b>
if the output of your function is periodic then you should specify the periodicity
of the function. <i></i></div></div>=NO 
...<span style="display:none;" id="eg2doubleg"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg2b" onclick='showPath("eg2","eg2b")'>b: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_b_i_a_s_v_a_l_u_e.html" style="color:green">BIASVALUE</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg2doubleg">doubleg</b> <span style="display:none;" id="eg2b"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg2hhphi" onclick='showPath("eg2","eg2hhphi")'>hhphi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_h_i_s_t_o_g_r_a_m.html" style="color:green">HISTOGRAM</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg2phi">phi</b> <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the data should be collected and added to the quantity being
averaged <i></i></div></div>=50 <div class="tooltip">GRID_MIN<div class="right"><b>compulsory keyword </b>
the lower bounds for the grid <i></i></div></div>=-pi <div class="tooltip">GRID_MAX<div class="right"><b>compulsory keyword </b>
the upper bounds for the grid <i></i></div></div>=pi <div class="tooltip">GRID_BIN<div class="right">the number of bins for the grid <i></i></div></div>=600 <div class="tooltip">BANDWIDTH<div class="right"><b>compulsory keyword </b>
the bandwidths for kernel density estimation <i></i></div></div>=0.1 <span style="display:none;" id="eg2hhphi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg2hhpsi" onclick='showPath("eg2","eg2hhpsi")'>hhpsi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_h_i_s_t_o_g_r_a_m.html" style="color:green">HISTOGRAM</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg2psi">psi</b> <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the data should be collected and added to the quantity being
averaged <i></i></div></div>=50 <div class="tooltip">GRID_MIN<div class="right"><b>compulsory keyword </b>
the lower bounds for the grid <i></i></div></div>=-pi <div class="tooltip">GRID_MAX<div class="right"><b>compulsory keyword </b>
the upper bounds for the grid <i></i></div></div>=pi <div class="tooltip">GRID_BIN<div class="right">the number of bins for the grid <i></i></div></div>=600 <div class="tooltip">BANDWIDTH<div class="right"><b>compulsory keyword </b>
the bandwidths for kernel density estimation <i></i></div></div>=0.1 <span style="display:none;" id="eg2hhpsi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg2ffphi" onclick='showPath("eg2","eg2ffphi")'>ffphi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_c_o_n_v_e_r_t__t_o__f_e_s.html" style="color:green">CONVERT_TO_FES</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the input grid you would like to use <i></i></div></div>=<b name="eg2hhphi">hhphi</b> <span style="display:none;" id="eg2ffphi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg2ffpsi" onclick='showPath("eg2","eg2ffpsi")'>ffpsi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_c_o_n_v_e_r_t__t_o__f_e_s.html" style="color:green">CONVERT_TO_FES</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the input grid you would like to use <i></i></div></div>=<b name="eg2hhpsi">hhpsi</b> <span style="display:none;" id="eg2ffpsi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_u_m_p_g_r_i_d.html" style="color:green">DUMPGRID</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the grid you would like to output <i></i></div></div>=<b name="eg2ffphi">ffphi</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword ( default=density )</b>
the file on which to write the grid. <i></i></div></div>=fes_phi <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=0 )</b>
the frequency with which the grid should be output to the file. <i></i></div></div>=100000 <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_u_m_p_g_r_i_d.html" style="color:green">DUMPGRID</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the grid you would like to output <i></i></div></div>=<b name="eg2ffpsi">ffpsi</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword ( default=density )</b>
the file on which to write the grid. <i></i></div></div>=fes_psi <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=0 )</b>
the frequency with which the grid should be output to the file. <i></i></div></div>=100000 <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg2phi">phi</b>,<b name="eg2psi">psi</b>,<b name="eg2b">b.bias</b> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=colvar.dat <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=50 <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>It is now possible to run a second simulation and observe the new behavior. The system quickly explores a new minimum. While a quantitative estimate of the free energy difference of the old and new regions is out of the scope of the current exercise what we can do is to add a new von Mises function centered in the new minimum with a comparable height, in this way we can hope to facilitate a back and forth transition along the phi collective variable. Look at the old and new free energy and add a third exponential function to <a class="el" href="_c_u_s_t_o_m.html">CUSTOM</a> centered in the new minimum.</p>
<pre class="fragment">gnuplot&gt; plot 'fes_phi' u 1:(-$2+38) w l
gnuplot&gt; f(x)=exp(k3*cos(x-a3))
gnuplot&gt;k3=2
gnuplot&gt; fit [0.3:1.8] f(x) 'fes_phi' u 1:(-$2+38) via k3,a3
</pre><p>We can now run a third simulation where both regions are biased.</p>
<h1><a class="anchor" id="lugano-2-ex-3"></a>
Exercise 3: Second biased run with alanine dipeptide</h1>

<div style="width: 90%; float:left" id="value_details_eg3"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.7-incomplete-yellow.svg" alt="tested on v2.7" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue">#SETTINGS MOLFILE=user-doc/tutorials/lugano-2/diala.pdb</span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <div class="tooltip">STRUCTURE<div class="right"><b>compulsory keyword </b>
a file in pdb format containing a reference structure. <i></i></div></div>=diala.pdb <span style="display:none;" id="eg3"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3phi" onclick='showPath("eg3","eg3phi")'>phi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=@phi-2 <span style="display:none;" id="eg3phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3psi" onclick='showPath("eg3","eg3psi")'>psi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=@psi-2 <span style="display:none;" id="eg3psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3tripleg" onclick='showPath("eg3","eg3tripleg")'>tripleg: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_c_u_s_t_o_m.html" style="color:green">CUSTOM</a> ...
   <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg3phi">phi</b> 
   
   <div class="tooltip">FUNC<div class="right"><b>compulsory keyword </b>
the function you wish to evaluate <i></i></div></div>=exp(__FILL__*cos(x-__FILL__))+exp(__FILL__*cos(x-__FILL__))+exp(__FILL__*cos(x-__FILL__)) 
   <div class="tooltip">PERIODIC<div class="right"><b>compulsory keyword </b>
if the output of your function is periodic then you should specify the periodicity
of the function. <i></i></div></div>=NO 
...<span style="display:none;" id="eg3tripleg"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3b" onclick='showPath("eg3","eg3b")'>b: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_b_i_a_s_v_a_l_u_e.html" style="color:green">BIASVALUE</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg3tripleg">tripleg</b> <span style="display:none;" id="eg3b"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3hhphi" onclick='showPath("eg3","eg3hhphi")'>hhphi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_h_i_s_t_o_g_r_a_m.html" style="color:green">HISTOGRAM</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg3phi">phi</b> <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the data should be collected and added to the quantity being
averaged <i></i></div></div>=50 <div class="tooltip">GRID_MIN<div class="right"><b>compulsory keyword </b>
the lower bounds for the grid <i></i></div></div>=-pi <div class="tooltip">GRID_MAX<div class="right"><b>compulsory keyword </b>
the upper bounds for the grid <i></i></div></div>=pi <div class="tooltip">GRID_BIN<div class="right">the number of bins for the grid <i></i></div></div>=600 <div class="tooltip">BANDWIDTH<div class="right"><b>compulsory keyword </b>
the bandwidths for kernel density estimation <i></i></div></div>=0.1 <span style="display:none;" id="eg3hhphi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3hhpsi" onclick='showPath("eg3","eg3hhpsi")'>hhpsi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_h_i_s_t_o_g_r_a_m.html" style="color:green">HISTOGRAM</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg3psi">psi</b> <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the data should be collected and added to the quantity being
averaged <i></i></div></div>=50 <div class="tooltip">GRID_MIN<div class="right"><b>compulsory keyword </b>
the lower bounds for the grid <i></i></div></div>=-pi <div class="tooltip">GRID_MAX<div class="right"><b>compulsory keyword </b>
the upper bounds for the grid <i></i></div></div>=pi <div class="tooltip">GRID_BIN<div class="right">the number of bins for the grid <i></i></div></div>=600 <div class="tooltip">BANDWIDTH<div class="right"><b>compulsory keyword </b>
the bandwidths for kernel density estimation <i></i></div></div>=0.1 <span style="display:none;" id="eg3hhpsi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3ffphi" onclick='showPath("eg3","eg3ffphi")'>ffphi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_c_o_n_v_e_r_t__t_o__f_e_s.html" style="color:green">CONVERT_TO_FES</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the input grid you would like to use <i></i></div></div>=<b name="eg3hhphi">hhphi</b> <span style="display:none;" id="eg3ffphi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3ffpsi" onclick='showPath("eg3","eg3ffpsi")'>ffpsi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_c_o_n_v_e_r_t__t_o__f_e_s.html" style="color:green">CONVERT_TO_FES</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the input grid you would like to use <i></i></div></div>=<b name="eg3hhpsi">hhpsi</b> <span style="display:none;" id="eg3ffpsi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_u_m_p_g_r_i_d.html" style="color:green">DUMPGRID</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the grid you would like to output <i></i></div></div>=<b name="eg3ffphi">ffphi</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword ( default=density )</b>
the file on which to write the grid. <i></i></div></div>=fes_phi <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=0 )</b>
the frequency with which the grid should be output to the file. <i></i></div></div>=100000 <span style="display:none;" id="eg3"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_u_m_p_g_r_i_d.html" style="color:green">DUMPGRID</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the grid you would like to output <i></i></div></div>=<b name="eg3ffpsi">ffpsi</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword ( default=density )</b>
the file on which to write the grid. <i></i></div></div>=fes_psi <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=0 )</b>
the frequency with which the grid should be output to the file. <i></i></div></div>=100000 <span style="display:none;" id="eg3"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg3phi">phi</b>,<b name="eg3psi">psi</b>,<b name="eg3b">b.bias</b> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=colvar.dat <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=50 <span style="display:none;" id="eg3"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>With this third simulation it should be possible to visit both regions as a function on the phi torsion. The resulting free energy is now reporting about the biased simulation is flatter than the former even if not flat everywhere. Now it is possible to reweight the sampling and obtain a better free energy estimate along phi.</p>

<div style="width: 90%; float:left" id="value_details_eg4"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.7-incomplete-yellow.svg" alt="tested on v2.7" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue">#SETTINGS MOLFILE=user-doc/tutorials/lugano-2/diala.pdb</span>
<span style="color:blue"># vim:ft=plumed</span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <div class="tooltip">STRUCTURE<div class="right"><b>compulsory keyword </b>
a file in pdb format containing a reference structure. <i></i></div></div>=diala.pdb <span style="display:none;" id="eg4"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4phi" onclick='showPath("eg4","eg4phi")'>phi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=@phi-2 <span style="display:none;" id="eg4phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4psi" onclick='showPath("eg4","eg4psi")'>psi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=@psi-2 <span style="display:none;" id="eg4psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4tripleg" onclick='showPath("eg4","eg4tripleg")'>tripleg: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_m_a_t_h_e_v_a_l.html" style="color:green">MATHEVAL</a> ...
   <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg4phi">phi</b> 
   
   <div class="tooltip">FUNC<div class="right"><b>compulsory keyword </b>
the function you wish to evaluate <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> 
   <div class="tooltip">PERIODIC<div class="right"><b>compulsory keyword </b>
if the output of your function is periodic then you should specify the periodicity
of the function. <i></i></div></div>=NO 
...<span style="display:none;" id="eg4tripleg"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4b" onclick='showPath("eg4","eg4b")'>b: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_b_i_a_s_v_a_l_u_e.html" style="color:green">BIASVALUE</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg4tripleg">tripleg</b> <span style="display:none;" id="eg4b"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4as" onclick='showPath("eg4","eg4as")'>as: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_w_e_i_g_h_t__b_i_a_s.html" style="color:green">REWEIGHT_BIAS</a> <div class="tooltip">ARG<div class="right"><b>compulsory keyword ( default=*.bias )</b>
the biases that must be taken into account when reweighting <i></i></div></div>=<b name="eg4b">b.bias</b> <span style="display:none;" id="eg4as"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4hhphi" onclick='showPath("eg4","eg4hhphi")'>hhphi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_h_i_s_t_o_g_r_a_m.html" style="color:green">HISTOGRAM</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg4phi">phi</b> <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the data should be collected and added to the quantity being
averaged <i></i></div></div>=50 <div class="tooltip">GRID_MIN<div class="right"><b>compulsory keyword </b>
the lower bounds for the grid <i></i></div></div>=-pi <div class="tooltip">GRID_MAX<div class="right"><b>compulsory keyword </b>
the upper bounds for the grid <i></i></div></div>=pi <div class="tooltip">GRID_BIN<div class="right">the number of bins for the grid <i></i></div></div>=600 <div class="tooltip">BANDWIDTH<div class="right"><b>compulsory keyword </b>
the bandwidths for kernel density estimation <i></i></div></div>=0.1 <div class="tooltip">LOGWEIGHTS<div class="right">list of actions that calculates log weights that should be used to weight configurations
when calculating averages <i></i></div></div>=<b name="eg4as">as</b> <span style="display:none;" id="eg4hhphi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4hhpsi" onclick='showPath("eg4","eg4hhpsi")'>hhpsi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_h_i_s_t_o_g_r_a_m.html" style="color:green">HISTOGRAM</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg4psi">psi</b> <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the data should be collected and added to the quantity being
averaged <i></i></div></div>=50 <div class="tooltip">GRID_MIN<div class="right"><b>compulsory keyword </b>
the lower bounds for the grid <i></i></div></div>=-pi <div class="tooltip">GRID_MAX<div class="right"><b>compulsory keyword </b>
the upper bounds for the grid <i></i></div></div>=pi <div class="tooltip">GRID_BIN<div class="right">the number of bins for the grid <i></i></div></div>=600 <div class="tooltip">BANDWIDTH<div class="right"><b>compulsory keyword </b>
the bandwidths for kernel density estimation <i></i></div></div>=0.1 <div class="tooltip">LOGWEIGHTS<div class="right">list of actions that calculates log weights that should be used to weight configurations
when calculating averages <i></i></div></div>=<b name="eg4as">as</b> <span style="display:none;" id="eg4hhpsi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4ffphi" onclick='showPath("eg4","eg4ffphi")'>ffphi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_c_o_n_v_e_r_t__t_o__f_e_s.html" style="color:green">CONVERT_TO_FES</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the input grid you would like to use <i></i></div></div>=<b name="eg4hhphi">hhphi</b> <div class="tooltip">STRIDE<div class="right"><b> could not find this keyword </b><i></i></div></div>=100000 <span style="display:none;" id="eg4ffphi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4ffpsi" onclick='showPath("eg4","eg4ffpsi")'>ffpsi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_c_o_n_v_e_r_t__t_o__f_e_s.html" style="color:green">CONVERT_TO_FES</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the input grid you would like to use <i></i></div></div>=<b name="eg4hhpsi">hhpsi</b> <div class="tooltip">STRIDE<div class="right"><b> could not find this keyword </b><i></i></div></div>=100000 <span style="display:none;" id="eg4ffpsi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_u_m_p_g_r_i_d.html" style="color:green">DUMPGRID</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the grid you would like to output <i></i></div></div>=<b name="eg4ffphi">ffphi</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword ( default=density )</b>
the file on which to write the grid. <i></i></div></div>=<b name="eg4ffphi">ffphi.dat</b> <span style="display:none;" id="eg4"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_u_m_p_g_r_i_d.html" style="color:green">DUMPGRID</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the grid you would like to output <i></i></div></div>=<b name="eg4ffpsi">ffpsi</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword ( default=density )</b>
the file on which to write the grid. <i></i></div></div>=<b name="eg4ffpsi">ffpsi.dat</b> <span style="display:none;" id="eg4"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg4phi">phi</b>,<b name="eg4psi">psi</b>,<b name="eg4b">b.bias</b> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=colvar.dat <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=50 <span style="display:none;" id="eg4"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>Of notice that the reweighting is also applied to the psi collective variable. If you have performed your simulations in different folder you can compare the effect of the bias on phi on the free energy of psi. For a single simulation with a constant bias the reweighting is simple, the weight of each frame is exp(+bias(cv(t))/kt). So it is possible to perform the reweighting by hand at any time.</p>
<p>Now you have performed an original Umbrella Sampling calculation. This is not particularly easy to setup nor robust, even if from a modern perspective it is a very rough implementation of <a class="el" href="_m_e_t_a_d.html">METAD</a></p>
<p>In the next exercise we will perform a WHAM Umbrella Sampling simulation.</p>
<h1><a class="anchor" id="lugano-2-ex-4"></a>
Exercise 4: WHAM Umbrella Sampling</h1>
<p>In this case we will run many simulations with a strong harmonic restraint centered around specific values of phi in such a way to cover all possible values, keep each simulation close to its specific value, allow for overlap between neighbor simulations, i.e. simulations centered around consecutive phi values. The simulation can be either performed in parallel by preparing starting configurations close to each value or sequentially, extracting a good starting conformation from the former simulations. In the specific case of alanine dipeptide we can even just start always from the same configuration and let the bias quickly move it close to the target values.</p>
<p>To run the simulation in scalar you can make use of the provided bash script that is:</p>
<pre class="fragment">for AT in -3.00  -2.75 -2.50 -2.25 -2.00 -1.75 -1.50 -1.25 -1.00 -0.75 -0.50 -0.25 0.00 0.25 0.50 0.75 1.00 1.25 1.50 1.75 2.00 2.25 2.50 2.75 3.00
do

cat &gt;plumed.dat &lt;&lt; EOF
# vim:ft=plumed
MOLINFO STRUCTURE=diala.pdb
phi: TORSION ATOMS=@phi-2
psi: TORSION ATOMS=@psi-2
#
# Impose an umbrella potential on CV 1
# with a spring constant of 250 kjoule/mol
# at fixed points along phi 
#
restraint-phi: RESTRAINT ARG=phi KAPPA=250.0 AT=$AT
# monitor the two variables and the bias potential from the two restraints
PRINT STRIDE=20 ARG=phi,psi,restraint-phi.bias FILE=COLVAR$AT
EOF

gmx mdrun -plumed plumed.dat -nsteps 100000 -x traj$AT.xtc -c cout$AT.gro -nb cpu

done
</pre><p>you can run it using</p>
<pre class="fragment">./run_us.sh
</pre><p>Plotting the phi collective variable for all replica you will see that each simulation has explored a well defined region of the conformation space as defined by phi. To perform the WHAM merging of the windows we need to 1) collect all the frames </p><pre class="fragment">gmx trjcat -f traj*.xtc -cat -o concatenated.xtc
</pre><p> 2) calculate the values for all employed biases applied on each frame for this we can write a plumed-wham.dat file including all the biases used in the former simulations: </p>
<div style="width: 90%; float:left" id="value_details_eg5"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.7-passing-green.svg" alt="tested on v2.7" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue">#SETTINGS MOLFILE=user-doc/tutorials/lugano-2/diala.pdb</span>
<span style="color:blue"># vim:ft=plumed</span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <div class="tooltip">STRUCTURE<div class="right"><b>compulsory keyword </b>
a file in pdb format containing a reference structure. <i></i></div></div>=diala.pdb <span style="display:none;" id="eg5">The MOLINFO action with label <b></b></span>
<b name="eg5phi" onclick='showPath("eg5","eg5phi")'>phi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=@phi-2 <span style="display:none;" id="eg5phi">The TORSION action with label <b>phi</b> calculates a single scalar value</span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=-3.00 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=-2.75 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=-2.50 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=-2.25 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=-2.00 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=-1.75 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=-1.50 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=-1.25 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=-1.00 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=-0.75 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=-0.50 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=-0.25 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=0.00 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=0.25 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=0.50 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=0.75 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=1.00 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=1.25 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=1.50 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=1.75 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=2.00 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=2.25 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=2.50 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=2.75 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=3.00 <span style="display:none;" id="eg5">The RESTRAINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=*.bias <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=biases.dat <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=10 <span style="display:none;" id="eg5">The PRINT action with label <b></b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5phi">phi</b> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=allphi.dat <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=10 <span style="display:none;" id="eg5">The PRINT action with label <b></b></span>
</pre>
<pre class="fragment">plumed driver --mf_xtc concatenated.xtc --plumed plumed-wham.dat
</pre><p>3) run the iterative WHAM optimization and get a weight per frame </p><pre class="fragment">python wham.py biases.dat 25 2.49
</pre><p>where 25 is the number of windows and 2.49 is the temperature in energy unit. After some time the result is a file weight.dat with one weight per frame that can be used to calculate any possible property of the system. For example the free energy profile along phi.</p>
<p>To do so edit the weight.dat file to add 3 blank lines and then </p><pre class="fragment">paste allphi.dat weights.dat | grep -v \# &gt; allphi-w.dat
python do_fes.py allphi-w.dat 1 -3.1415 3.1415 50 2.49 fes.dat
</pre><p>the resulting profile will be disappointing, error estimate and convergence will be discussed in the following tutorials, but clearly simulations are too short. A more advanced approach would be to use the configurations obtained from the former simulations to generate multiple replicas and then perform the US again for longer time and possible in parallel. The syntax is presented in the following but the exercise is possible only if plumed is compiled with mpi</p>
<h1><a class="anchor" id="lugano-2-ex-5"></a>
Exercise 5: WHAM Umbrella Sampling in parallel (optional)</h1>
<p>Here we use the "replica" syntax of plumed to write a single plumed input file for all the windows:</p>

<div style="width: 90%; float:left" id="value_details_eg6"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.7-passing-green.svg" alt="tested on v2.7" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue">#SETTINGS FILENAME=plumed.dat MOLFILE=user-doc/tutorials/lugano-2/diala.pdb</span>
<span style="color:blue"># this is plumed.dat</span>
<span style="color:blue"># vim:ft=plumed</span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <div class="tooltip">STRUCTURE<div class="right"><b>compulsory keyword </b>
a file in pdb format containing a reference structure. <i></i></div></div>=diala.pdb <span style="display:none;" id="eg6">The MOLINFO action with label <b></b></span>
<b name="eg6phi" onclick='showPath("eg6","eg6phi")'>phi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=@phi-2 <span style="display:none;" id="eg6phi">The TORSION action with label <b>phi</b> calculates a single scalar value</span>
<b name="eg6psi" onclick='showPath("eg6","eg6psi")'>psi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=@psi-2 <span style="display:none;" id="eg6psi">The TORSION action with label <b>psi</b> calculates a single scalar value</span>
<span style="color:blue">#</span>
<span style="color:blue"># Impose an umbrella potential on CV 1</span>
<span style="color:blue"># with a spring constant of 250 kjoule/mol</span>
<span style="color:blue"># at fixed points along phi</span>
<span style="color:blue">#</span>
<b name="eg6restraint-phi" onclick='showPath("eg6","eg6restraint-phi")'>restraint-phi: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> ...
   <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg6phi">phi</b> <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword ( default=0.0 )</b>
specifies that the restraint is harmonic and what the values of the force constants
on each of the variables are <i></i></div></div>=250.0 
   <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the position of the restraint <i></i></div></div>=@replicas:{ 
     -3.00 -2.75 -2.50 -2.25 
     -2.00 -1.75 -1.50 -1.25 
     -1.00 -0.75 -0.50 -0.25 
      0.00 0.25 0.50 0.75 
      1.00 1.25 1.50 1.75 
      2.00 2.25 2.50 2.75 3.00 
     }  
...<span style="display:none;" id="eg6restraint-phi">The RESTRAINT action with label <b>restraint-phi</b> calculates the following quantities:
<table  align="center" frame="void" width="95%%" cellpadding="5%%">
<tr><td width="5%%"><b> Quantity </b>  </td><td><b> Description </b> </td></tr>
<tr><td width="5%%">restraint-phi.bias</td><td>the instantaneous value of the bias potential</td></tr><tr><td width="5%%">restraint-phi.force2</td><td>the instantaneous value of the squared force due to this bias potential</td></tr></table>
</span>
<span style="color:blue"># monitor the two variables and the bias potential from the restraint</span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=20 <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg6phi">phi</b>,<b name="eg6psi">psi</b>,<b name="eg6restraint-phi">restraint-phi.bias</b> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=COLVAR <span style="display:none;" id="eg6">The PRINT action with label <b></b></span>
</pre>
<p>The @replicas syntax allow to define different values for a variable for the different replicas.</p>
<pre class="fragment">mpiexec -np 25 gmx_mpi -s topol -plumed plumed.dat -multi 25 -replex 100 -nb cpu -nsteps 100000 
</pre><p>In this case we run 25 parallel simulations and we also try to perform replica-exchange between neighbor replicas.</p>
<p>Once the simulation is finished the trajectories can be concatenated and analyzed with WHAM making use of the plumed native implementation:</p>
<pre class="fragment">gmx_mpi trjcat -f traj*.xtc -o concatenated.xtc -cat
</pre><p>Write a new plumed-wham.dat</p>

<div style="width: 80%; float:left" id="value_details_eg7"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><button type="button" id="eg7_button" onclick='swapInput("eg7")'>contract shortcuts</button></div><div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.7-passing-green.svg" alt="tested on v2.7" /></div><div style="width: 100%; float:left" id="input_eg7"></div>
<pre style="width: 97%;" class="fragment"></pre>
<script type="text/javascript">
if (window.addEventListener) { // Mozilla, Netscape, Firefox
    window.addEventListener('load', eg7Load, false);
} else if (window.attachEvent) { // IE
    window.attachEvent('onload', eg7Load);
}
function eg7Load(event) {
       swapInput("eg7");
}
</script>
<div style="display:none;" id="eg7short">
<pre style="width: 97%;" class="fragment">
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_i_n_c_l_u_d_e.html" style="color:green">INCLUDE</a> <div class="tooltip">FILE<div class="right"><b>compulsory keyword </b>
file to be included <i></i></div></div>=plumed.dat <span style="display:none;" id="eg7short">The INCLUDE action with label <b></b></span>
<b name="eg7shorth1" onclick='showPath("eg7","eg7shorth1")'>h1: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_w_h_a_m__h_i_s_t_o_g_r_a_m.html" style="color:green">WHAM_HISTOGRAM</a> ...
   <div class="tooltip">ARG<div class="right"><b>compulsory keyword </b>
the arguments that you would like to make the histogram for <i></i></div></div>=phi <div class="tooltip">BIAS<div class="right"><b>compulsory keyword ( default=*.bias )</b>
the value of the biases to use when performing WHAM <i></i></div></div>=restraint-phi.bias <div class="tooltip">TEMP<div class="right"><b>compulsory keyword </b>
the temperature at which the simulation was run <i></i></div></div>=300 
   <div class="tooltip">GRID_MIN<div class="right"><b>compulsory keyword </b>
the minimum to use for the grid <i></i></div></div>=-pi <div class="tooltip">GRID_MAX<div class="right"><b>compulsory keyword </b>
the maximum to use for the grid <i></i></div></div>=pi <div class="tooltip">GRID_BIN<div class="right"><b>compulsory keyword </b>
the number of bins to use for the grid <i></i></div></div>=100 
   <div class="tooltip">BANDWIDTH<div class="right">the bandwidth for kernel density estimation <i></i></div></div>=0.1 
...<span style="display:none;" id="eg7shorth1">The WHAM_HISTOGRAM action with label <b>h1</b></span>
<b name="eg7shortfes1" onclick='showPath("eg7","eg7shortfes1")'>fes1: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_c_o_n_v_e_r_t__t_o__f_e_s.html" style="color:green">CONVERT_TO_FES</a> <div class="tooltip">TEMP<div class="right">the temperature at which you are operating <i></i></div></div>=300 <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the input grid you would like to use <i></i></div></div>=<b name="eg7shorth1">h1</b> <span style="display:none;" id="eg7shortfes1">The CONVERT_TO_FES action with label <b>fes1</b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_u_m_p_g_r_i_d.html" style="color:green">DUMPGRID</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the grid you would like to output <i></i></div></div>=<b name="eg7shortfes1">fes1</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword ( default=density )</b>
the file on which to write the grid. <i></i></div></div>=<b name="eg7shortfes1">fes1.dat</b> <span style="display:none;" id="eg7short">The DUMPGRID action with label <b></b></span>
</pre>
</div>
<div style="display:none;" id="eg7long"><pre style="width: 97%;" class="fragment">
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_i_n_c_l_u_d_e.html" style="color:green">INCLUDE</a> <div class="tooltip">FILE<div class="right"><b>compulsory keyword </b>
file to be included <i></i></div></div>=plumed.dat <span style="display:none;" id="eg7long">The INCLUDE action with label <b></b></span>
<b name="eg7longh1_weights" onclick='showPath("eg7","eg7longh1_weights")'>h1_weights: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_r_e_w_e_i_g_h_t__w_h_a_m.html" style="color:green">REWEIGHT_WHAM</a> <div class="tooltip">ARG<div class="right"><b>compulsory keyword ( default=*.bias )</b>
the biases that must be taken into account when reweighting <i></i></div></div>=restraint-phi.bias <div class="tooltip">TEMP<div class="right">the system temperature. <i></i></div></div>=300 <span style="display:none;" id="eg7longh1_weights">The REWEIGHT_WHAM action with label <b>h1_weights</b> calculates a single scalar value</span>
<b name="eg7longh1_collect" onclick='showPath("eg7","eg7longh1_collect")'>h1_collect: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_c_o_l_l_e_c_t__f_r_a_m_e_s.html" style="color:green">COLLECT_FRAMES</a> <div class="tooltip">LOGWEIGHTS<div class="right">list of actions that calculates log weights that should be used to weight configurations
when calculating averages <i></i></div></div>=<b name="eg7longh1_weights">h1_weights</b> <div class="tooltip">STRIDE<div class="right">the frequency with which data should be stored for analysis. <i></i></div></div>=1 <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=phi <span style="display:none;" id="eg7longh1_collect">The COLLECT_FRAMES action with label <b>h1_collect</b> calculates a single scalar value</span>
<b name="eg7longh1" onclick='showPath("eg7","eg7longh1")'>h1: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_h_i_s_t_o_g_r_a_m.html" style="color:green">HISTOGRAM</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg7longh1_collect">h1_collect.*</b> <div class="tooltip">GRID_MIN<div class="right"><b>compulsory keyword </b>
the lower bounds for the grid <i></i></div></div>=-pi <div class="tooltip">GRID_MAX<div class="right"><b>compulsory keyword </b>
the upper bounds for the grid <i></i></div></div>=pi <div class="tooltip">GRID_BIN<div class="right">the number of bins for the grid <i></i></div></div>=100 <div class="tooltip">BANDWIDTH<div class="right"><b>compulsory keyword </b>
the bandwidths for kernel density estimation <i></i></div></div>=0.1 <span style="display:none;" id="eg7longh1">The HISTOGRAM action with label <b>h1</b></span>
<b name="eg7longfes1" onclick='showPath("eg7","eg7longfes1")'>fes1: </b><a href="https://www.plumed.org/doc-v2.7/user-doc/html/_c_o_n_v_e_r_t__t_o__f_e_s.html" style="color:green">CONVERT_TO_FES</a> <div class="tooltip">TEMP<div class="right">the temperature at which you are operating <i></i></div></div>=300 <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the input grid you would like to use <i></i></div></div>=<b name="eg7longh1">h1</b> <span style="display:none;" id="eg7longfes1">The CONVERT_TO_FES action with label <b>fes1</b></span>
<a href="https://www.plumed.org/doc-v2.7/user-doc/html/_d_u_m_p_g_r_i_d.html" style="color:green">DUMPGRID</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the grid you would like to output <i></i></div></div>=<b name="eg7longfes1">fes1</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword ( default=density )</b>
the file on which to write the grid. <i></i></div></div>=<b name="eg7longfes1">fes1.dat</b> <span style="display:none;" id="eg7long">The DUMPGRID action with label <b></b></span>
</pre>
</div>
<p>And again use the <a class="el" href="driver.html">driver</a> in parallel:</p>
<pre class="fragment">mpiexec -np 25 plumed driver --mf_xtc concatenated.xtc --plumed plumed-wham.dat --multi 25
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
